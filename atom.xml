<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>不羁</title>
  
  <subtitle>别来无恙</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://leeyj.coding.me/"/>
  <updated>2019-04-26T07:40:26.622Z</updated>
  <id>https://leeyj.coding.me/</id>
  
  <author>
    <name>Leeyj</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>phpMyAdmin搭建</title>
    <link href="https://leeyj.coding.me/2019/04/26/phpMyAdmin%E6%90%AD%E5%BB%BA/"/>
    <id>https://leeyj.coding.me/2019/04/26/phpMyAdmin搭建/</id>
    <published>2019-04-26T07:30:09.000Z</published>
    <updated>2019-04-26T07:40:26.622Z</updated>
    
    <content type="html"><![CDATA[<h5 id="在已有的-lnmp-环境下搭建-phpMyAdmin。-由于服务器做了限制，隧道端口转发等都不能使用，导致-Navicat-管理工具不能使用，只能通过-phpMyAdmin-来进行管理了。"><a href="#在已有的-lnmp-环境下搭建-phpMyAdmin。-由于服务器做了限制，隧道端口转发等都不能使用，导致-Navicat-管理工具不能使用，只能通过-phpMyAdmin-来进行管理了。" class="headerlink" title="在已有的 lnmp 环境下搭建 phpMyAdmin。 由于服务器做了限制，隧道端口转发等都不能使用，导致 Navicat 管理工具不能使用，只能通过 phpMyAdmin 来进行管理了。"></a>在已有的 lnmp 环境下搭建 phpMyAdmin。 由于服务器做了限制，隧道端口转发等都不能使用，导致 Navicat 管理工具不能使用，只能通过 phpMyAdmin 来进行管理了。</h5><img src="/2019/04/26/phpMyAdmin搭建/2019/04/26/phpMyAdmin搭建/4.png" title="测试图片">]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;在已有的-lnmp-环境下搭建-phpMyAdmin。-由于服务器做了限制，隧道端口转发等都不能使用，导致-Navicat-管理工具不能使用，只能通过-phpMyAdmin-来进行管理了。&quot;&gt;&lt;a href=&quot;#在已有的-lnmp-环境下搭建-phpMyAdmin
      
    
    </summary>
    
      <category term="Linux运维日常" scheme="https://leeyj.coding.me/categories/Linux%E8%BF%90%E7%BB%B4%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="Linux运维日常" scheme="https://leeyj.coding.me/tags/Linux%E8%BF%90%E7%BB%B4%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>MySQL自动备份脚本</title>
    <link href="https://leeyj.coding.me/2019/04/24/MySQL%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/"/>
    <id>https://leeyj.coding.me/2019/04/24/MySQL自动备份脚本/</id>
    <published>2019-04-24T09:56:56.000Z</published>
    <updated>2019-04-25T05:08:45.051Z</updated>
    
    <content type="html"><![CDATA[<h5 id="通过-shell-脚本定时备份数据库，并定时清理"><a href="#通过-shell-脚本定时备份数据库，并定时清理" class="headerlink" title="通过 shell 脚本定时备份数据库，并定时清理"></a>通过 shell 脚本定时备份数据库，并定时清理</h5><p><code>ceshi yixia</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">#Desc:本地数据库备份脚本</span><br><span class="line">#Date:2017-12-24</span><br><span class="line">#by:Lee-YJ</span><br><span class="line">#运行脚本前先创建一个备份用户，并授予权限</span><br><span class="line">#mysql&gt; grant select,insert,lock tables,show view,trigger  on *.* to back@"127.0.0.1" identified by "oodaeh7phoe1iboh7Jua";</span><br><span class="line">#mysql&gt; flush privileges;</span><br><span class="line"></span><br><span class="line">mysqluser=back                    #用于数据库备份的用户名</span><br><span class="line">mysqlpassw=oodaeh7phoe1iboh7Jua   #用户密码</span><br><span class="line">mysqlhost=127.0.0.1               #连接数据库的host</span><br><span class="line">bakpath=/opt/data/Back/DBbak          #备份数据库存放的路径</span><br><span class="line"></span><br><span class="line">bakdate=`date '+%Y%m%d'`</span><br><span class="line">baktime=`date '+%H%M'`</span><br><span class="line"></span><br><span class="line">#----------------------------获取mysql中的数据库名---------------------------------</span><br><span class="line">/usr/bin/mysql -u$mysqluser -h $mysqlhost -p$mysqlpassw -e "show databases;"|grep -v Database|grep -v information_schema |grep -v performance_schema|grep -v mysql|grep -v test &gt; /tmp/DBname</span><br><span class="line"></span><br><span class="line">#----------------------------数据库备份--mysqldump备份------------------------------</span><br><span class="line"></span><br><span class="line">if [ ! -d "$bakpath" ];then</span><br><span class="line">    mkdir -p $bakpath</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd $bakpath</span><br><span class="line"></span><br><span class="line">if [ ! -d "$bakdate" ];then</span><br><span class="line">    mkdir $bakdate</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">cd $bakdate</span><br><span class="line"></span><br><span class="line">echo "------------------------$bakdate$baktime-------------------------------------" &gt;&gt; $bakpath/DBbak.log</span><br><span class="line">for DBname in `cat /tmp/DBname`;do</span><br><span class="line">    if [ ! -d "$DBname" ];then</span><br><span class="line">        mkdir $DBname</span><br><span class="line">    fi</span><br><span class="line">    /usr/bin/mysqldump --routines --triggers -u$mysqluser -h $mysqlhost -p$mysqlpassw $DBname  &gt; $DBname/$baktime\.sql</span><br><span class="line">    if [ $? = 0 ];then</span><br><span class="line">        echo "$DBname Back OK!" &gt;&gt; $bakpath/DBbak.log</span><br><span class="line">    else</span><br><span class="line">        echo "$DBname Back ERROR!" &gt;&gt; $bakpath/DBbak.log</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">echo "" &gt;&gt; $bakpath/DBbak.log </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#----------------------------删除5天之前的数据备份，并随机保留一份--------------------------------</span><br><span class="line">shopt -s extglob</span><br><span class="line">olddate=`date '+%Y%m%d' -d "-6 days"`</span><br><span class="line">cd $bakpath/$olddate</span><br><span class="line">for deldbname in `ls $bakpath/$olddate`;do</span><br><span class="line">    cd $deldbname</span><br><span class="line">    file=`ls| sort -R | head -n1`</span><br><span class="line">    rm -f !($file)</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ ! -d "$bakpath/Oldest" ];then</span><br><span class="line">    mkdir -p $bakpath/Oldest</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">mv $bakpath/$olddate $bakpath/Oldest/</span><br><span class="line"></span><br><span class="line">rm -f /tmp/DBname</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h5 id=&quot;通过-shell-脚本定时备份数据库，并定时清理&quot;&gt;&lt;a href=&quot;#通过-shell-脚本定时备份数据库，并定时清理&quot; class=&quot;headerlink&quot; title=&quot;通过 shell 脚本定时备份数据库，并定时清理&quot;&gt;&lt;/a&gt;通过 shell 脚本定时备
      
    
    </summary>
    
      <category term="Shell" scheme="https://leeyj.coding.me/categories/Shell/"/>
    
    
      <category term="Linux运维日常" scheme="https://leeyj.coding.me/tags/Linux%E8%BF%90%E7%BB%B4%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>ftp虚拟用户</title>
    <link href="https://leeyj.coding.me/2019/04/23/ftp%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7/"/>
    <id>https://leeyj.coding.me/2019/04/23/ftp虚拟用户/</id>
    <published>2019-04-23T14:30:00.000Z</published>
    <updated>2019-04-23T14:37:22.762Z</updated>
    
    <content type="html"><![CDATA[<h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><p>进（账户）\<br>username: ftpComeSsbq\<br>password: ftp<em>come</em>#@UkieO9\<br>上传文件的目录：/opt/ftp/come</p><p>出（账户）\<br>username: ftpOutSsbq\<br>password: ftp<em>out</em>#@45oUkie\<br>上床文件的目录：/opt/ftp/out</p><h3 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h3><p>1 安装软件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install vsftpd</span><br></pre></td></tr></table></figure></p><p>2 创建相应的ftp数据目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkdir -p /opt/ftp/&#123;come,out&#125;</span><br></pre></td></tr></table></figure></p><p>3 创建一个用户提供给虚拟用户使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># useradd -s /sbin/nologin virtual</span><br></pre></td></tr></table></figure></p><p>4 将ftp数据目录设置成virtual用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># chown virtual. /opt/ftp/ -R</span><br><span class="line"># ll /opt/ftp/</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x 2 virtual virtual 4096 Apr 17 12:07 come</span><br><span class="line">drwxr-xr-x 2 virtual virtual 4096 Apr 17 12:07 out</span><br></pre></td></tr></table></figure></p><p>5 创建虚拟帐号与密码的文本文件(一行账号，一行密码, 注意不要有多余的空格)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/vsftpd/logins.txt</span><br><span class="line">ftpComeSsbq</span><br><span class="line">ftp_come_#@UkieO9</span><br><span class="line">ftpOutSsbq</span><br><span class="line">ftp_out_#@45oUkie</span><br></pre></td></tr></table></figure></p><p>6 将创建好的密码文件txt格式转换db格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># db_load -T -t hash -f /etc/vsftpd/logins.txt /etc/vsftpd/login.db</span><br></pre></td></tr></table></figure></p><p>7 定义db文件的权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># chmod 600 /etc/vsftpd/login.db</span><br></pre></td></tr></table></figure></p><p>8 定义pam认证文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/pam.d/ftp</span><br><span class="line">auth  required  /lib64/security/pam_userdb.so  db=/etc/vsftpd/login</span><br><span class="line">account  required  /lib64/security/pam_userdb.so  db=/etc/vsftpd/login</span><br></pre></td></tr></table></figure></p><p>9 配置vsftpd主配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># cp /etc/vsftpd/vsftpd.conf&#123;,.bak&#125;</span><br><span class="line"># vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">#禁止匿名登录FTP服务器</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">#允许本地用户登录FTP服务器</span><br><span class="line">local_enable=YES</span><br><span class="line">#可以上传(全局控制) </span><br><span class="line">write_enable=NO</span><br><span class="line">#匿名用户可以上传</span><br><span class="line">anon_upload_enable=NO</span><br><span class="line">#匿名用户可以建目录</span><br><span class="line">anon_mkdir_write_enable=NO</span><br><span class="line">#匿名用户修改删除</span><br><span class="line">anon_other_write_enable=NO</span><br><span class="line">#全部用户被限制在主目录</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">#将所有用户看成虚拟用户guest</span><br><span class="line">guest_enable=YES</span><br><span class="line">#指定虚拟用户，也就是将guest用户映射到virtual用户</span><br><span class="line">guest_username=virtual</span><br><span class="line">#指定为独立服务</span><br><span class="line">listen=YES</span><br><span class="line">#指定监听的端口</span><br><span class="line">listen_port=21</span><br><span class="line">#开启被动模式</span><br><span class="line">pasv_enable=YES</span><br><span class="line">#FTP服务器公网IP</span><br><span class="line">pasv_address=120.79.93.66</span><br><span class="line">#设置被动模式下，建立数据传输可使用port范围的最小值</span><br><span class="line">pasv_min_port=10000</span><br><span class="line">#设置被动模式下，建立数据传输可使用port范围的最大值</span><br><span class="line">pasv_max_port=10088</span><br><span class="line">#是否允许匿名用户下载全局可读的文件</span><br><span class="line">anon_world_readable_only=NO</span><br><span class="line">#指定虚拟用户配置文件的路径</span><br><span class="line">user_config_dir=/etc/vsftpd/user_conf</span><br></pre></td></tr></table></figure></p><p>10 创建上面配置文件中指定的子配置文件目录 user_conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># mkdir /etc/vsftpd/user_conf</span><br></pre></td></tr></table></figure></p><p>11 定义 ftpComeSsbq 用户的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/vsftpd/user_conf/ftpComeSsbq</span><br><span class="line">write_enable=YES</span><br><span class="line">anon_world_readable_only=no</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line">local_root=/opt/ftp/come</span><br></pre></td></tr></table></figure></p><p>12 定义 ftpOutSsbq 用户的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/vsftpd/user_conf/ftpOutSsbq</span><br><span class="line">write_enable=YES</span><br><span class="line">anon_world_readable_only=no</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">anon_other_write_enable=YES</span><br><span class="line">local_root=/opt/ftp/out</span><br></pre></td></tr></table></figure></p><p>13 启动vsftpd<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># service vsftpd start</span><br></pre></td></tr></table></figure></p><p>14 测试<br>…</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;需求：&quot;&gt;&lt;a href=&quot;#需求：&quot; class=&quot;headerlink&quot; title=&quot;需求：&quot;&gt;&lt;/a&gt;需求：&lt;/h3&gt;&lt;p&gt;进（账户）\&lt;br&gt;username: ftpComeSsbq\&lt;br&gt;password: ftp&lt;em&gt;come&lt;/em&gt;#@Uk
      
    
    </summary>
    
      <category term="Linux" scheme="https://leeyj.coding.me/categories/Linux/"/>
    
    
      <category term="Linux运维日常" scheme="https://leeyj.coding.me/tags/Linux%E8%BF%90%E7%BB%B4%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
</feed>
